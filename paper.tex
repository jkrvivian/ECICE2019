\documentclass[journal,a4paper]{IEEEtran}

% to typeset URLs, URIs, and DOIs
\usepackage[english]{babel}
\usepackage{url}
\usepackage{multicol}
\usepackage{multirow}
\usepackage{url,hyperref,graphicx,float,times}
\usepackage{textcomp}
\usepackage{cite}
\usepackage[caption=false,font=footnotesize]{subfig}
\usepackage{amsmath}


\begin{document}
%
\title{Decentralized Data Marketplace to Enable Trusted Machine Economy}
%
\author{
%%% Fill in name here
\IEEEauthorblockN{Ching-Chun (Jim) Huang\IEEEauthorrefmark{1}, Ching-Hua Lin\IEEEauthorrefmark{2}} \\

%%% Fill in school here
\IEEEauthorblockA{\IEEEauthorrefmark{1}\IEEEauthorrefmark{2}Department of Computer Science and Information Engineering National Cheng Kung University} \\

%%% Fill in address here
\IEEEauthorblockA{\IEEEauthorrefmark{1}\IEEEauthorrefmark{2}No.1, University Road} \\

%%% Fill in city and country here
\IEEEauthorblockA{\IEEEauthorrefmark{1}\IEEEauthorrefmark{2}Tainan City, Taiwan (R.O.C.)} \\

%%% Fill in email here
\IEEEauthorblockA{\IEEEauthorrefmark{1}jserv.tw@gmail.com, \IEEEauthorrefmark{2}jkrvivian@gmail.com}
}


%


\maketitle              
% 50-80 words
\begin{abstract}
abstract here
\end{abstract}

% 3 - 4 keywords
\begin{IEEEkeywords}
streaming data, crowd sensing, data marketplace, decentralization
\end{IEEEkeywords}

\section{Introduction}

\section{Related Work}
The increasing IoT devices brings a huge amount of data, the economic value becomes essential for parties intended to sell, buy and find data. The need for IoT data marketplace arises due to this. Recent years, several researchers has started to explore based on this concept. There are some critical issues need to be resolved in the design of data marketplace platform, in this paper, we focus on two issues, data integrity and the trading behavior.

To ensure data integrity for IoT applications is always a challenge because of the unstandardize data format and dynamic nature. Moreover, the Third Party Auditors (TPAs)-based frameworks is far from being satisfactory. Therefore a decentralized data integrity validation has been proposed recent years, and blockchain is considered a solution. 

Data Integrity as a Service (DIaas) is a blockchain based framework for data integrity proposed by Bin Liu\cite{DIaas}. DIaas is a Cloud Server Service (CSS) for IoT dynamic data that allows both data owner and data consumer to validate data integrity by comparing hashes on smart contract  and on Cloud Server. Besides, smart contract can also realize the purchase agreement, including authorizing data consumer for specific data set and even the penalty for data provider if they fail to provide the data integrity. However, the performance analysis shows that IoT devices still have low efficiency interacting with Etheruem, this may fall to the Proof-of-Work (PoW) process is time-consuming for an IoT device and the blockchain consensus can not be reached within a short time, while Ethereum is expected to enable consensus within 12-second but the time is still longer when the authors wrote the paper. 

By solving the inefficiencies of the Blockchain, \textbf{IOTA}\cite{IOTAwhitepaper} is a cryptocurrency for the IoT industry or Web 3.0 based on the revolutionary distributed ledger technology, the \textbf{Tangle}. It is a secure, scalable and feeless transaction settlement layer which enables micropayments transaction. On top of that, \textbf{Masked Authenticated Messaging(MAM)}\cite{MAM}, a second layer data communication protocol which adds functionality to emit and access an encrypted data stream over the Tangle where privacy and integrity meet is introduced to public. On the basis of the Tangle and MAM, IOTA foundation proposed a fully decentralized Data MarketPlace which is suitable for IoT streaming data that not only allow data owners and consumers to trade on Tangle but also protect privacy and assure data integrity from source with MAM. But only the data buyout doesn't meet the need of the real world, such as data subscription and a specific time period of data maybe needed for different uses. Moreover, even though IOTA needs less computing power than other blockchain system, doing PoW and unstable network environment are still the bottleneck for low-level devices, it may take 2 or more minutes to issue a transaction to Tangle under MAM protocol.

A different framework design proposed by Pooja Gupta, Salil S.Kanhere and Raja Jurdak\cite{3tierDataMarket} could solve the efficiency problem as mentioned. The infrastructure is a 3-tier decentralized data marketplace architectural design with smart contract which consists of provider, consumer and broker. Where broker is a highly resourced and trustless device that will facilitate the trading of data between the consumer and providers. However, there are some potential threats need to be resolved, such as payment fairness, authentication of the participants, faithful delivery of data and probable malicious behaviour of data marketplace participants.  

Our proposed data marketplace framework is a 3-tier decentralized and trustless architecture that put data stream and trading process on distrubted ledgers. In our infrastructure, the identity of each participants could be easily verified with a self-soverign identity system, also we design the refunding mechanism to protect the payment fairness. Moreover, with MAM as our data storage on IOTA, data could be delivered securely and faithfully without any third-parties.


\section{System Architecture}
\subsection{Participants}
There are four major roles in the decentralized data marketplace.

\subsubsection{Registrar}
Registrar is responsible for creating a Registration Contract, which maintains a lookup table of participants, and adding new data providers, consumers and brokers to the decentralized data marketplace.

\subsubsection{Data Provider}
Data providers, who generate and preserve IoT data, are willing to sell sensing data to consumers. They decide the subscription period, subscription price, data type, sampling frequency. Afterward, they can launch the product on the decentralized data marketplace. Next, they collect raw data with their sensors and send to the broker who assists in uploading data to the network. An MAM channel\cite{MAM} is used to store encrypted data stream.

\subsubsection{Consumer}
Consumers aspire to obtain IoT data to promote the value of their service. However, it is a big challenge for most consumers to collect the desired data by themselves. So they look forward to purchasing the IoT data from data providers.

\subsubsection{Broker}
Brokers represent data providers and consumers to do computing tasks in the DLT (Distributed Ledger Technology) since brokers are expected to have high computing power. Once a data provider wants to launch a new product, the data provider requests a broker to create a new MAM channel, a new Product Contract, which specifies details about products, and upload this product to the IPFS (InterPlanetary File System)\cite{IPFS}. Also the broker certifies the session key which is used for symmetric encryption for streaming data encryption and decryption. Then the broker provides the matching service for data provider’s products and consumer’s queries. After that, the broker is requested to deal with the trading process and upload the provider’s data streams to the MAM channel.

\section{Trading Model}
In the following, we describe the data trading process in detail. To participate a data marketplace, data providers and consumers have to register first. Then data provider can launch its product on the marketplace. Once a product is launched, it is searchable and could be traded afterward. The whole trading and refunding process is defined in smart contracts which are easily traceable and irreversible.

\subsection{Participants Registration}
At the beginning, the registrar creates a Registration Contact, which maintains all participants' information, including their DID (Decentralized Identifiers) information and public keys. Then some preselected brokers who are trustworthy are added to the decentralized data marketplace. Anyone who would like to sell or purchase data may register to become the data providers or consumers. The registrar has the authority to agree with applications.

\subsection{Launching and Searching Products}
To sell the sensing data, a data provider has to launch a new product on the data marketplace in advance. The data provider determines a trusted broker and asks the broker to create a new MAM channel and Product Contract.

Brokers certify session keys as well. However, it is a risk revealing session keys to brokers since contents may be copied by brokers, which causes data providers' loss. Therefore, Blind signature is used to prevent the situation. When a data provider asks a broker to ceritfy new session key, the data provider uses the broker's public key, which is available in the Registration Contact after the broker's registration, as a blinding factor, and the session key is blinded. Then the data provider sends the blinded session key to the broker. The broker signs the message and returns the signature to data provider. The data provider removes the blinding factor and obtains the broker's signature of the session key. Only one session key can be signed in each product, so data providers can't fake a session key to deceive consumers.

The contract address and product description will be stored in a file which is uploaded to IPFS. Consumers can search the desired product by keywords or tags. The consumer then evaluates the product and start trading with the data provider if the consumer is interested in subscribing the data.

\subsection{Trading}
Once a consumer who want to subscribe the sensor data pays a subscription fee to the Product Contract, it is added to the subscriber list automatically by the smart contract. To decrypt the streaming data on the MAM channel, session key should be exchanged between data provider and subscribers. The data provider requests the subscription list maintained by the Product Contract and obtains accounts of each subscriber. After that, the data provider can also get public keys of each subscriber from the Registration Contact with their accounts. For each subscriber, the data provider encrypts the session key and broker's signature with the subscriber's public key and sends the ciphertext to the Product Contract. Subscribers listen to the smart contract event which is triggered when the ciphertext is updated, and decrypt the ciphertext to get the session key and signature. Subscribers can obtain the broker's public key on the Registration Contact as well, so they can verify that the signature is valid and the session key is the only one that is certified by the broker. Afterward, encrypted sensing data is uploaded to the MAM channel, and subscribers can download and decrypt them with the session¸

\subsection{Refunding}
It is probable that the sensor is malfunctioning after the subscribers pay the subscription fee. To protect subscribers' right, the subscription fee are not transfered to the data provider until all data is generated and uploaded to the MAM channel. If the expected data is not available, subscribers can ask for refunds. We assume that less than half of subscribers in the Product Contract are irrational and malicious. Each subscriber can vote for refunding at any time. If the ratio of consent votes of refunding is higher than the $threshold$ at $k$th data samples, the subscription fee is proportionally transfered to the data provider, broker and every subscriber. The subscription fee can be prorated as below:

\begin{equation}
F_{DataProvider}(k) = N price \frac{k-1}{M} (1-F_{b}) (1-F_{t})
\end{equation}

\begin{equation}
F_{Broker}(k) = N price \frac{k-1}{M} F_{b} (1-F_{t})
\end{equation}

\begin{equation}
F_{Consumer}(k) = price \frac{M-k+1}{M} (1-F_{t})
\end{equation}

Where $price$  is the subscription price, $M$ is the number of expected data samples, $F_{b}$ is the brokerage fee(\%), $F_{t}$ is the transaction fee of the smart contract(\%), $N$ is the number of subscribers in this contract.

\section{Conclusion}



  





% ---- Bibliography ----
\bibliographystyle{IEEEtran}
\bibliography{references}


\end{document}
